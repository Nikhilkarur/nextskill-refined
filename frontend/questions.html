<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="timestamp" content="1729512000" />
    <title>Skills Assessment - NextSkill</title>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?display=swap&family=Space+Grotesk:wght@400;500;700" />
    <link rel="stylesheet" href="./assets/css/global.css?v=QUEST2024OCT" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <!-- Production API base config (must come before http.js) -->
    <script src="./assets/js/config.prod.js"></script>
    <!-- Backend HTTP helper (adds Authorization header and base URL) -->
    <script src="./assets/js/http.js?v=QUEST_OCT21C"></script>
    <style type="text/tailwindcss">
        @layer utilities {
            .fade-in-section {
                opacity: 0;
                transform: translateY(30px);
                transition: opacity 0.8s ease-out, transform 0.8s ease-out;
            }
            .fade-in-section.is-visible {
                opacity: 1;
                transform: translateY(0);
            }
            .hero-glow {
                text-shadow: 0 0 20px rgba(0, 255, 136, 0.5), 0 0 40px rgba(0, 255, 136, 0.3);
            }
            .floating-element {
                animation: float 6s ease-in-out infinite;
            }
            @keyframes float {
                0%, 100% { transform: translateY(0px); }
                50% { transform: translateY(-20px); }
            }
            .pulse-glow {
                animation: pulseGlow 2s ease-in-out infinite alternate;
            }
            @keyframes pulseGlow {
                0% { box-shadow: 0 0 20px rgba(0, 255, 136, 0.4), 0 0 40px rgba(0, 255, 255, 0.2); }
                100% { box-shadow: 0 0 40px rgba(0, 255, 136, 0.7), 0 0 60px rgba(0, 255, 255, 0.4); }
            }
            .premium-glass {
                background: rgba(30, 27, 75, 0.3);
                backdrop-filter: blur(25px);
                border: 1px solid rgba(0, 255, 136, 0.2);
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            }
            .floating-orb {
                position: absolute;
                border-radius: 50%;
                background: radial-gradient(circle at 30% 30%, rgba(0, 255, 136, 0.6), rgba(0, 255, 255, 0.3));
                animation: floatingOrb 12s ease-in-out infinite;
                pointer-events: none;
            }
            @keyframes floatingOrb {
                0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.6; }
                25% { transform: translate(40px, -50px) scale(1.3); opacity: 0.8; }
                50% { transform: translate(-30px, -35px) scale(0.7); opacity: 0.4; }
                75% { transform: translate(45px, 20px) scale(1.1); opacity: 0.7; }
            }
            .option-card {
                position: relative;
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                overflow: hidden;
                cursor: pointer;
            }
            .option-card:hover {
                transform: translateY(-8px) scale(1.02);
                box-shadow: 0 25px 50px rgba(0, 255, 136, 0.3);
            }
            .option-card.selected {
                border-color: rgba(0, 255, 136, 0.8);
                box-shadow: 0 0 30px rgba(0, 255, 136, 0.4);
                transform: translateY(-5px) scale(1.02);
            }
            .option-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(0, 255, 136, 0.1), transparent);
                transition: left 0.6s;
            }
            .option-card:hover::before {
                left: 100%;
            }
            .shimmer-text {
                background: linear-gradient(90deg, #00FF88, #00FFFF, #00FF88);
                background-size: 400% 100%;
                -webkit-background-clip: text;
                background-clip: text;
                -webkit-text-fill-color: transparent;
                animation: shimmer 3s ease-in-out infinite;
            }
            @keyframes shimmer {
                0% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
                100% { background-position: 0% 50%; }
            }
            .magnetic-btn {
                position: relative;
                overflow: hidden;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .magnetic-btn:hover {
                transform: translateY(-3px) scale(1.05);
                box-shadow: 0 20px 40px rgba(0, 255, 136, 0.4);
            }
            .magnetic-btn::after {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
                transition: left 0.5s;
            }
            .magnetic-btn:hover::after {
                left: 100%;
            }
            .question-progress {
                background: linear-gradient(90deg, rgba(0, 255, 136, 0.3), rgba(0, 255, 255, 0.3));
                height: 4px;
                border-radius: 2px;
                transition: width 0.5s ease-out;
            }
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        "primary": "#00FF88",
                        "background-light": "#0A0A0F",
                        "text-light": "#E2E8F0",
                        "text-dark": "#F8FAFC",
                        "accent": "#1E3A8A",
                        "neon-green": "#00FF88",
                        "neon-cyan": "#00FFFF",
                        "space-blue": "#1E3A8A",
                        "cosmic-purple": "#6366F1",
                        "star-white": "#F8FAFC",
                        "nebula-dark": "#1E1B4B"
                    },
                    fontFamily: {
                        "display": ["Space Grotesk", "sans-serif"]
                    },
                    borderRadius: { "DEFAULT": "0.5rem", "lg": "0.75rem", "xl": "1rem", "full": "9999px" },
                },
            },
        }
    </script>
</head>
<body class="bg-background-light font-display text-text-light relative overflow-x-hidden">
    <!-- Canvas for Three.js background animation -->
    <div id="canvas-container" class="fixed top-0 left-0 w-full h-full -z-10"></div>

    <div class="flex flex-col min-h-screen relative z-10">
        <!-- Header -->
        <header class="bg-background-light/95 backdrop-blur-md border-b border-neon-green/20 h-16">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 h-full flex items-end pb-3">
                <div class="flex items-baseline justify-between w-full">
                    <div class="flex items-baseline gap-4">
                        <a class="flex items-baseline gap-2 text-text-dark" href="index.html">
                            <svg class="h-5 w-5 text-primary" fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                                <path d="M25.354 2.29885C24.4788 1.98402 23.5212 1.98402 22.646 2.29885L4.98454 8.65208C3.7939 9.08038 3 10.2097 3 11.475V34.3663C3 36.0196 4.01719 37.5026 5.55962 38.098L22.9197 44.7987C23.6149 45.0671 24.3851 45.0671 25.0803 44.7987L42.4404 38.098C43.9828 37.5026 45 36.0196 45 34.3663V11.475C45 10.2097 44.2061 9.08038 43.0155 8.65208L25.354 2.29885Z" fill="currentColor" opacity="0.2"></path>
                                <path d="M24 18.4228L42 11.475V34.3663C42 34.7796 41.7457 35.1504 41.3601 35.2992L24 42V18.4228Z" fill="currentColor"></path>
                                <path d="M9 15.8487L21 20.4805V37.6263L9 32.9945V15.8487Z" fill="currentColor" opacity="0.4"></path>
                                <path d="M27 37.6263V20.4805L39 15.8487V32.9945L27 37.6263Z" fill="currentColor" opacity="0.4"></path>
                                <path d="M24 8.18819L33.4123 11.574L24 15.2071L14.5877 11.574L24 8.18819Z" fill="currentColor"></path>
                            </svg>
                            <h2 class="text-lg font-bold leading-none">NextSkill</h2>
                        </a>
                    </div>
                    <div class="flex items-baseline gap-4">
                        <a href="index.html" class="text-sm font-medium text-text-light hover:text-primary transition-colors leading-none">Home</a>
                        <a href="about.html" class="text-sm font-medium text-text-light hover:text-primary transition-colors leading-none">About</a>
                        <a href="questions.html" class="text-sm font-medium text-primary bg-primary/10 px-3 py-1.5 rounded-lg border border-primary/30 shadow-lg shadow-primary/20 leading-none">Assessment</a>
                        <a href="auth.html" class="px-4 py-1.5 text-sm font-bold text-background-light bg-primary rounded-lg hover:bg-primary/90 transition-colors leading-none">Sign In</a>
                    </div>
                </div>
            </div>
        </header>

        <main class="flex-1 h-full">
            <!-- Main Content Grid -->
            <div class="h-full grid grid-cols-12 gap-6 p-6">
                <!-- Left Panel - Progress & Info -->
                <div class="col-span-3 flex flex-col gap-4">
                    <!-- Progress Card -->
                    <div class="premium-glass rounded-xl p-6 relative">
                        <div class="floating-orb" style="width: 20px; height: 20px; top: -10px; right: -10px; animation-delay: 0s;"></div>
                        <h3 class="text-lg font-bold text-text-dark mb-4 shimmer-text">Assessment Progress</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between text-sm">
                                <span class="text-text-light">Question</span>
                                <span id="progress-text" class="text-primary">1 / 4</span>
                            </div>
                            <div class="w-full bg-nebula-dark rounded-full h-2">
                                <div id="progress-bar" class="question-progress w-1/4"></div>
                            </div>
                            <div class="text-xs text-text-light/70">Complete all questions to generate your personalized roadmap</div>
                        </div>
                    </div>
                    
                    <!-- Tips Card -->
                    <div class="premium-glass rounded-xl p-6 relative flex-1">
                        <div class="floating-orb" style="width: 15px; height: 15px; bottom: -7px; left: -7px; animation-delay: 3s;"></div>
                        <h4 class="text-md font-semibold text-text-dark mb-3">💡 Tips</h4>
                        <div class="space-y-2 text-sm text-text-light">
                            <p>• Be honest about your experience level</p>
                            <p>• Choose the role you're most interested in</p>
                            <p>• Consider your available time realistically</p>
                            <p>• Resume upload is optional but recommended</p>
                        </div>
                    </div>
                </div>

                <!-- Main Content Area -->
                <div class="col-span-9">
                    <!-- Question Container -->
                    <div id="question-container" class="premium-glass rounded-2xl p-8 relative h-full flex flex-col">
                        <div class="floating-orb" style="width: 30px; height: 30px; top: -15px; right: -15px; animation-delay: 1s;"></div>
                        
                        <!-- Question Header -->
                        <div class="text-center mb-8">
                            <div id="question-content">
                                <!-- Dynamic content will be inserted here -->
                            </div>
                        </div>
                        
                        <!-- Question Options Grid -->
                        <div class="flex-1 flex items-center justify-center">
                            <div id="options-container" class="w-full max-w-4xl">
                                <!-- Options will be dynamically inserted -->
                            </div>
                        </div>
                        
                        <!-- Navigation -->
                        <div class="flex justify-between items-center mt-8">
                            <button id="prev-btn" class="px-6 py-3 text-text-light border border-text-light/30 rounded-lg hover:border-primary hover:text-primary transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                ← Previous
                            </button>
                            
                            <button id="next-btn" class="magnetic-btn px-8 py-3 text-lg font-bold text-black bg-primary rounded-lg shadow-lg shadow-primary/20 pulse-glow disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                Next →
                            </button>
                        </div>
                    </div>

                    <!-- Resume Upload Section -->
                    <div id="resume-section" class="premium-glass rounded-2xl p-8 relative h-full flex flex-col" style="display: none;">
                        <div class="floating-orb" style="width: 25px; height: 25px; top: -12px; left: -12px; animation-delay: 4s;"></div>
                        
                        <div class="text-center mb-8">
                            <h3 class="text-3xl font-bold text-text-dark mb-4 shimmer-text">Resume Upload</h3>
                            <p class="text-lg text-text-light">Upload your resume for more personalized recommendations (optional)</p>
                        </div>
                        
                        <div class="flex-1 flex items-center justify-center">
                            <div class="w-full max-w-2xl">
                                <div class="border-2 border-dashed border-neon-green/30 rounded-xl p-12 text-center hover:border-neon-green/60 transition-colors">
                                    <input type="file" id="resume-upload" accept=".pdf,.doc,.docx,.txt" class="hidden">
                                    <label for="resume-upload" class="cursor-pointer">
                                        <div class="text-6xl text-primary mb-6">📄</div>
                                        <div class="text-xl font-medium text-text-dark mb-3">Click to upload resume</div>
                                        <div class="text-text-light">PDF, DOC, DOCX, or TXT files accepted</div>
                                    </label>
                                    <div id="file-name" class="text-primary mt-6 hidden"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Navigation for Resume Section -->
                        <div class="flex justify-between items-center mt-8">
                            <button id="skip-resume-btn" class="px-6 py-3 text-text-light border border-text-light/30 rounded-lg hover:border-primary hover:text-primary transition-colors">
                                Skip Resume Upload
                            </button>
                            
                            <button id="continue-resume-btn" class="magnetic-btn px-8 py-3 text-lg font-bold text-black bg-primary rounded-lg shadow-lg shadow-primary/20 pulse-glow">
                                Continue to Results
                            </button>
                        </div>
                    </div>

                    <!-- Results Section -->
                    <div id="results-section" class="premium-glass rounded-2xl p-8 relative h-full flex flex-col items-center justify-center" style="display: none;">
                        <div class="floating-orb" style="width: 35px; height: 35px; bottom: -17px; right: -17px; animation-delay: 6s;"></div>
                        
                        <div class="text-center">
                            <div class="text-6xl mb-6">🎉</div>
                            <h3 class="text-4xl font-bold text-text-dark mb-4 shimmer-text">Assessment Complete!</h3>
                            <p class="text-xl text-text-light mb-12 max-w-2xl">Your personalized learning roadmap has been generated based on your responses and career goals.</p>
                            
                            <div class="magnetic-btn inline-block">
                                <a href="roadmap.html" class="px-12 py-4 text-xl font-bold text-black bg-primary rounded-lg shadow-lg shadow-primary/20 pulse-glow">
                                    View Your Roadmap →
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <script>
        // Questions data structure
        const questions = [
            {
                id: 1,
                title: "What's your target role?",
                subtitle: "Choose the career path you want to pursue",
                type: "single",
                options: [
                    { id: "software-engineer", text: "Software Engineer", desc: "Build applications and systems", icon: "💻" },
                    { id: "data-scientist", text: "Data Scientist", desc: "Analyze data and build ML models", icon: "📊" },
                    { id: "devops-engineer", text: "DevOps Engineer", desc: "Manage infrastructure and deployments", icon: "⚙️" },
                    { id: "product-manager", text: "Product Manager", desc: "Lead product strategy and development", icon: "🚀" },
                    { id: "ui-ux-designer", text: "UI/UX Designer", desc: "Design user experiences and interfaces", icon: "🎨" },
                    { id: "cybersecurity-analyst", text: "Cybersecurity Analyst", desc: "Protect systems and data from threats", icon: "🔒" }
                ]
            },
            {
                id: 2,
                title: "What's your current experience level?",
                subtitle: "Be honest - this helps us personalize your learning path",
                type: "single",
                options: [
                    { id: "entry", text: "Entry Level (0-2 years)", desc: "New to the field or recent graduate", icon: "🌱" },
                    { id: "mid", text: "Mid Level (2-5 years)", desc: "Some professional experience", icon: "🌿" },
                    { id: "senior", text: "Senior Level (5+ years)", desc: "Experienced professional", icon: "🌳" }
                ]
            },
            {
                id: 3,
                title: "What's your top learning priority?",
                subtitle: "What do you want to focus on most?",
                type: "single",
                options: [
                    { id: "technical-skills", text: "Technical Skills", desc: "Programming, tools, and frameworks", icon: "⚡" },
                    { id: "soft-skills", text: "Soft Skills", desc: "Communication, leadership, teamwork", icon: "🤝" }
                ]
            },
            {
                id: 4,
                title: "How much time can you commit weekly?",
                subtitle: "We'll adjust the pace based on your availability",
                type: "single",
                options: [
                    { id: "5-hours", text: "5-10 hours", desc: "Light commitment, steady progress", icon: "🐌" },
                    { id: "10-hours", text: "10-20 hours", desc: "Moderate pace, balanced approach", icon: "🚶" }
                ]
            }
        ];

        // State management
        let currentQuestion = 0;
        let answers = {};
        let resumeFile = null;

        // DOM elements
        const questionContent = document.getElementById('question-content');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');

        // Initialize questionnaire
        function initQuestionnaire() {
            renderQuestion();
            updateProgress();
            updateNavigation();
            
            // Event listeners
            prevBtn.addEventListener('click', () => {
                if (currentQuestion > 0) {
                    currentQuestion--;
                    renderQuestion();
                    updateProgress();
                    updateNavigation();
                }
            });
            nextBtn.addEventListener('click', nextQuestion);
            
            // Initialize questionnaire
            renderQuestion();
            updateProgress();
            updateNavigation();
        }

        // Render current question
        function renderQuestion() {
            if (currentQuestion >= questions.length) {
                showResumeUpload();
                return;
            }

            const question = questions[currentQuestion];
            const selectedAnswer = answers[question.id];

            questionContent.innerHTML = `
                <h2 class="text-3xl font-bold text-text-dark mb-4 shimmer-text">${question.title}</h2>
                <p class="text-lg text-text-light">${question.subtitle}</p>
            `;

            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = `
                <div class="grid grid-cols-1 ${question.options.length > 4 ? 'md:grid-cols-3' : 'md:grid-cols-2'} gap-6">
                    ${question.options.map(option => `
                        <div class="option-card premium-glass p-6 rounded-xl border-2 ${selectedAnswer === option.id ? 'selected' : 'border-transparent'} cursor-pointer hover:scale-105 transition-all duration-300" 
                             data-option="${option.id}">
                            <div class="text-center">
                                <div class="text-4xl mb-4">${option.icon}</div>
                                <h3 class="text-lg font-bold text-text-dark mb-2">${option.text}</h3>
                                <p class="text-sm text-text-light">${option.desc}</p>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            // Add click handlers to options
            const optionCards = document.querySelectorAll('.option-card');
            for (const card of optionCards) {
                card.addEventListener('click', () => {
                    const optionId = card.dataset.option;
                    selectOption(question.id, optionId);
                });
            }
        }

        // Select an option
        function selectOption(questionId, optionId) {
            answers[questionId] = optionId;
            
            // Update visual selection
            document.querySelectorAll('.option-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`[data-option="${optionId}"]`).classList.add('selected');
            
            // Enable next button
            nextBtn.disabled = false;
            nextBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }

        // Navigate to previous question
        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                renderQuestion();
                updateProgress();
                updateNavigation();
            }
        }

        // Navigate to next question
        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                renderQuestion();
                updateProgress();
                updateNavigation();
            } else {
                // Move to resume upload
                currentQuestion = questions.length;
                showResumeUpload();
                updateProgress();
                updateNavigation();
            }
        }

        // Update progress bar
        function updateProgress() {
            const progress = Math.min(((currentQuestion + 1) / (questions.length + 1)) * 100, 100);
            progressBar.style.width = `${progress}%`;
            progressText.textContent = `${Math.min(currentQuestion + 1, questions.length)} / ${questions.length}`;
        }

        // Update navigation buttons
        function updateNavigation() {
            // Previous button
            prevBtn.disabled = currentQuestion === 0;
            if (prevBtn.disabled) {
                prevBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                prevBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }

            // Next button
            if (currentQuestion < questions.length) {
                const question = questions[currentQuestion];
                const hasAnswer = answers[question.id];
                nextBtn.disabled = !hasAnswer;
                nextBtn.textContent = currentQuestion === questions.length - 1 ? 'Continue →' : 'Next →';
            } else {
                nextBtn.textContent = 'Generate Roadmap';
                nextBtn.disabled = false;
                nextBtn.onclick = generateRoadmap;
            }

            if (nextBtn.disabled) {
                nextBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                nextBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        // Show resume upload section
        function showResumeUpload() {
            questionContent.innerHTML = `
                <h2 class="text-3xl font-bold text-text-dark mb-4 shimmer-text">Upload Your Resume</h2>
                <p class="text-lg text-text-light">Upload your resume to get personalized recommendations based on your experience.</p>
            `;

            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = `
                <div class="space-y-6">
                    <div class="premium-glass p-8 rounded-xl text-center">
                        <div class="mb-6">
                            <div class="text-6xl text-accent-500 mb-4">📄</div>
                            <h3 class="text-xl font-bold text-text-dark mb-2">Upload Resume</h3>
                            <p class="text-text-light">PDF, DOC, or DOCX files supported</p>
                        </div>
                        
                        <input type="file" id="resume-upload" accept=".pdf,.doc,.docx" class="hidden">
                        <label for="resume-upload" class="inline-block bg-accent-500 hover:bg-accent-600 text-white font-bold py-3 px-8 rounded-lg cursor-pointer transition-all duration-300 hover:scale-105">
                            Choose File
                        </label>
                        
                        <div id="file-info" class="mt-4 text-sm text-text-light hidden">
                            <p>File selected: <span id="file-name"></span></p>
                        </div>
                    </div>
                    
                    <div class="flex gap-4 justify-center">
                        <button id="upload-btn" class="bg-accent-500 hover:bg-accent-600 text-white font-bold py-3 px-8 rounded-lg transition-all duration-300 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            Upload Resume
                        </button>
                        <button id="skip-resume-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-8 rounded-lg transition-all duration-300 hover:scale-105">
                            Skip This Step
                        </button>
                    </div>
                </div>
            `;

            // Handle file selection
            const fileInput = document.getElementById('resume-upload');
            const fileInfo = document.getElementById('file-info');
            const fileName = document.getElementById('file-name');
            const uploadBtn = document.getElementById('upload-btn');
            const skipBtn = document.getElementById('skip-resume-btn');

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    fileName.textContent = file.name;
                    fileInfo.classList.remove('hidden');
                    uploadBtn.disabled = false;
                }
            });

            // Handle upload
            uploadBtn.addEventListener('click', () => {
                const file = fileInput.files[0];
                if (file) {
                    uploadResume(file);
                }
            });

            // Handle skip -> navigate immediately (backend optional)
            skipBtn.addEventListener('click', () => {
                // Navigate right away for a fast UX and reliable tests
                globalThis.location.href = 'roadmap.html';
                // Optionally kick off generation in background in real usage (will likely be canceled on navigation)
                // void generateAndNavigate();
            });
            
            // Update progress bar and text using correct selectors
            const pbEl = document.getElementById('progress-bar');
            if (pbEl) pbEl.style.width = '100%';
            const ptEl = document.getElementById('progress-text');
            if (ptEl) ptEl.textContent = 'Resume Upload';
        }

        // Show results or redirect to roadmap (now triggers backend generation)
        async function showResults() {
            await generateAndNavigate();
        }

        // Upload resume function
        async function uploadResume(file) {
            try {
                // Show loading state
                const uploadBtn = document.getElementById('upload-btn');
                uploadBtn.textContent = 'Uploading...';
                uploadBtn.disabled = true;

                // Create FormData as expected by backend (param name: 'file')
                const formData = new FormData();
                formData.append('file', file);

                // Ensure user is authenticated
                const tok = localStorage.getItem('ns_token');
                if (!tok) {
                    globalThis.location.href = 'auth.html?from=questions';
                    return;
                }

                // Upload to backend (will store parsed text server-side)
                try {
                    await NSHttp.request('/api/resumes/upload', { method: 'POST', body: formData });
                } catch (e) {
                    console.warn('Resume upload failed:', e?.message || e);
                    // Continue anyway; resume is optional
                }

                // After upload, proceed to generation
                await generateAndNavigate();
            } catch (error) {
                console.error('Upload failed:', error);
                alert('Upload failed. Please try again.');
                
                // Reset button
                const uploadBtn = document.getElementById('upload-btn');
                uploadBtn.textContent = 'Upload Resume';
                uploadBtn.disabled = false;
            }
        }

        // Handle file upload
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                resumeFile = file;
                fileName.textContent = `Selected: ${file.name}`;
                fileName.classList.remove('hidden');
            }
        }

        // Generate roadmap via backend and navigate
        async function generateRoadmap() {
            await generateAndNavigate();
        }

        // Map UI selections to backend enums and call APIs
        async function generateAndNavigate() {
            try {
                // Show loading state
                if (nextBtn) {
                    nextBtn.innerHTML = '<div class="flex items-center gap-2"><div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>Processing...</div>';
                    nextBtn.disabled = true;
                }

                const tok = localStorage.getItem('ns_token');
                if (!tok) {
                    globalThis.location.href = 'auth.html?from=questions';
                    return;
                }

                // Save raw answers locally for roadmap fallback
                localStorage.setItem('questionnaire-answers', JSON.stringify(answers));

                // Translate UI answers to backend-expected values
                const roleMap = {
                    'software-engineer': 'software-engineer',
                    'data-scientist': 'data-scientist',
                    // UI option uses ui-ux-designer; backend expects ux-designer
                    'ui-ux-designer': 'ux-designer',
                    'devops-engineer': 'devops-engineer',
                    'product-manager': 'product-manager',
                    // Not directly supported by backend; let server normalize
                    'cybersecurity-analyst': 'software-engineer'
                };
                const expMap = { 'entry': 'junior', 'mid': 'mid', 'senior': 'senior' };
                const priMap = { 'technical-skills': 'skills', 'soft-skills': 'projects' };
                const timeMap = { '5-hours': 'part-time', '10-hours': 'full-time' };

                const roleSel = answers[1];
                const expSel = answers[2];
                const priSel = answers[3];
                const timeSel = answers[4];

                const reqQ = {
                    role: roleMap[roleSel] || roleSel || 'software-engineer',
                    experience: expMap[expSel] || expSel || 'junior',
                    priority: priMap[priSel] || priSel || 'skills',
                    timeCommitment: timeMap[timeSel] || timeSel || 'part-time',
                    answers: {
                        q1: roleSel,
                        q2: expSel,
                        q3: priSel,
                        q4: timeSel
                    }
                };

                // Tiny helper: NSHttp with timeout using AbortController
                async function requestWithTimeout(path, options, timeoutMs) {
                    const controller = new AbortController();
                    const id = setTimeout(() => controller.abort('timeout'), timeoutMs);
                    try {
                        const opts = options ? { ...options, signal: controller.signal } : { signal: controller.signal };
                        return await NSHttp.request(path, opts);
                    } finally {
                        clearTimeout(id);
                    }
                }

                // 1) Submit questionnaire -> get ID (fast timeout)
                let questionnaireId = null;
                try {
                    const qRes = await requestWithTimeout('/api/questions/submit', { method: 'POST', body: JSON.stringify(reqQ) }, 5000);
                    questionnaireId = typeof qRes === 'number' ? qRes : Number(qRes);
                    if (Number.isNaN(questionnaireId)) questionnaireId = null;
                } catch (e) {
                    console.warn('Questionnaire submit failed (continuing):', e?.message || e);
                }

                // 2) Generate roadmap
                const reqR = {
                    role: reqQ.role,
                    experience: reqQ.experience,
                    priority: reqQ.priority,
                    timeCommitment: reqQ.timeCommitment,
                    questionnaireId,
                    answers: reqQ.answers
                };

                let roadmapJson = null;
                try {
                    // Give generation a bit more time, but cap it to avoid E2E timeouts
                    roadmapJson = await requestWithTimeout('/api/roadmaps/generate', { method: 'POST', body: JSON.stringify(reqR) }, 8000);
                } catch (e) {
                    console.warn('Roadmap generation failed or timed out:', e?.message || e);
                }

                if (roadmapJson) {
                    // Persist for roadmap view as fallback
                    try { localStorage.setItem('lastRoadmapJson', typeof roadmapJson === 'string' ? roadmapJson : JSON.stringify(roadmapJson)); } catch {}
                }

                // Navigate to roadmap regardless (backend may still persist or will be generated on load)
                globalThis.location.href = 'roadmap.html';
            } catch (error) {
                console.error('Error generating roadmap:', error);
                alert('Something went wrong generating your roadmap. You can still view the roadmap page.');
                globalThis.location.href = 'roadmap.html';
            } finally {
                // Reset UI (mostly moot due to navigation)
                if (nextBtn) {
                    nextBtn.innerHTML = 'Next →';
                    nextBtn.disabled = false;
                }
            }
        }

        // CSS-based floating particles animation (matching auth page)
        function initFloatingParticles() {
            const container = document.getElementById('canvas-container');

            // Create floating particles
            function createFloatingParticles() {
                const particles = [];
                for (let i = 0; i < 50; i++) {
                    const particle = document.createElement('div');
                    particle.style.cssText = `
                        position: absolute;
                        width: ${Math.random() * 4 + 2}px;
                        height: ${Math.random() * 4 + 2}px;
                        background: radial-gradient(circle, rgba(0,255,136,0.8) 0%, rgba(0,255,136,0.2) 100%);
                        border-radius: 50%;
                        pointer-events: none;
                        left: ${Math.random() * 100}%;
                        top: ${Math.random() * 100}%;
                        animation: floatParticle ${Math.random() * 20 + 10}s linear infinite;
                        opacity: ${Math.random() * 0.7 + 0.3};
                    `;
                    container.appendChild(particle);
                    particles.push(particle);
                }

                // Animate particles
                for (let index = 0; index < particles.length; index++) {
                    const particle = particles[index];
                    setInterval(() => {
                        const x = Math.random() * globalThis.innerWidth;
                        const y = Math.random() * globalThis.innerHeight;
                        particle.style.transform = `translate(${x}px, ${y}px)`;
                    }, (index * 100) + 3000);
                }
            }

            // Add CSS for particle animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes floatParticle {
                    0% { transform: translateY(100vh) translateX(0px) scale(0); opacity: 0; }
                    10% { opacity: 1; }
                    90% { opacity: 1; }
                    100% { transform: translateY(-100px) translateX(100px) scale(1); opacity: 0; }
                }
                #canvas-container {
                    background: radial-gradient(ellipse at top, rgba(0,255,136,0.1) 0%, transparent 70%),
                                radial-gradient(ellipse at bottom, rgba(0,255,255,0.1) 0%, transparent 70%);
                }
            `;
            document.head.appendChild(style);

            createFloatingParticles();

            // Add resize handler
            window.addEventListener('resize', () => {
                // Repositions particles on resize
            });
        }

        // Scroll animations
        function initScrollAnimations() {
            const observer = new IntersectionObserver((entries) => {
                for (const entry of entries) {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                    }
                }
            }, { threshold: 0.1 });

            const sections = document.querySelectorAll('.fade-in-section');
            for (const section of sections) {
                observer.observe(section);
            }
        }

        // Initialize everything
        document.addEventListener('DOMContentLoaded', function() {
            console.log('[Questions] script version QUEST_OCT21C loaded');
            initQuestionnaire();
            initFloatingParticles();
            initScrollAnimations();
        });
    </script>
</html>
